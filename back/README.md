# clj-server-practice/back

A project to practice of creating web server in clojure.

## Setup

- clojure cli

## Usage

```sh
clj -X:run db migrate
clj -X:dev
```

### Tips


### Build an uberjar

```sh
clojure -X:uberjar
java -jar back.jar server-with-migration
```

## License

Copyright © 2022 Asuki

_EPLv1.0 is just the default for projects generated by `clj-new`: you are not_
_required to open source this project, nor are you required to use EPLv1.0!_
_Feel free to remove or change the `LICENSE` file and remove or update this_
_section of the `README.md` file!_

Distributed under the Eclipse Public License version 1.0.

## test commands

```sh
AUTH_BEARER="XXYYZZ"
HOST=http://localhost:3000

function escape_str () {
  echo "$1" | sed 's/\\/\\\\/g' | sed 's/\"/\\"/g'
}

WHERE="[{\"key\": [\"data\", \"camera_id\"], \"action\": \"not_null\"}]"
ESCAPED_WHERE=$(escape_str "$WHERE")
ORDER="[{\"key\": \"created_at\", \"dir\": \"desc\"}]"
ESCAPED_ORDER=$(escape_str "$ORDER")
QUERY="{ raw_device_logs(where: \"$ESCAPED_WHERE\", order: \"$ESCAPED_ORDER\") { total list { id created_at data } } } }"
ESCAPED_QUERY=$(escape_str "$QUERY")
JSON="{\"query\": \"$ESCAPED_QUERY\"}"

curl -X POST ${HOST}/graphql \
  -H "Authorization: Bearer $AUTH_BEARER" \
  -H "Content-Type: application/json" \
  -d "$JSON"
```

## References

- [Game Rating Mutation](https://lacinia.readthedocs.io/en/latest/tutorial/rating-mutation.html)
- [samples/buddy-auth/src/buddy_auth/service.clj](https://github.com/pedestal/pedestal/blob/master/samples/buddy-auth/src/buddy_auth/service.clj)
- [Lacinia アプリ開発 Tips](https://qiita.com/223kazuki/items/50e5f62f19fed751ba40)
- [buddyでユーザ認証](https://qiita.com/totakke/items/30c0582ad9cdd6a34cba)
- [jdbc-ring-session](https://github.com/luminus-framework/jdbc-ring-session)
- [graphqlの動作確認をcurlで実施](https://asukiaaa.blogspot.com/2024/02/test-graphql-with-using-curl.html)
- [Watch and auto reload a Clojure pedestal service on source change ](https://dev.to/praburajan/watch-and-auto-reload-a-clojure-pedestal-service-on-save-4ehl)
- [Your First API](http://pedestal.io/guides/your-first-api)
- [How can I reload code in a Clojure pedestal repl for a quick development workflow?](https://stackoverflow.com/questions/36390571/how-can-i-reload-code-in-a-clojure-pedestal-repl-for-a-quick-development-workflo)
- [pedestal/samples/auto-reload-server/dev/dev.clj](https://github.com/pedestal/samples/blob/master/auto-reload-server/dev/dev.clj#L38)
- [lacinia-pedestal/src/com/walmartlabs/lacinia/pedestal.clj](https://github.com/walmartlabs/lacinia-pedestal/blob/88468c0c1ba0bc7a84fcafb20ce6150e48545e18/src/com/walmartlabs/lacinia/pedestal.clj)
- [lacinia-pedestal/docs/_examples/custom-setup.edn](https://github.com/walmartlabs/lacinia-pedestal/blob/e70f853ff96ac2c8f315bc5a6d429213df0c5d04/docs/_examples/custom-setup.edn)
- [Routing Quick Reference](http://pedestal.io/reference/routing-quick-reference)
- [Clojureサービス開発ライブラリPedestal入門](https://qiita.com/lagenorhynque/items/fbd66ebaa0352ec4253d)
- [サービス間連携のためのGraphQL APIをClojureで開発している話](https://tech-magazine.opt.ne.jp/entry/2021/01/13/124551)
- [GitHub GraphQLにcurlでqueryを投げる](https://qiita.com/ikemura23/items/4b0dd5a82abc9364638e)
- [ClojureでGraphQLサーバを立てる](https://qiita.com/223kazuki/items/ba4ba84e2da1daea3b52)
- [Ring について知る](https://ayato-p.github.io/clojure-beginner/intro_web_development/part2_what_is_ring.html)
- [clojure/webstore-demo/integrant-simple-server/deps.edn](https://github.com/karimarttila/clojure/blob/master/webstore-demo/integrant-simple-server/deps.edn)
- [Clojure で Web アプリケーションを作るときに Compojure の代わりに bidi を使う](https://qiita.com/ayato_p/items/8ed4688a4540491e87e0)
- [ClojureのWeb開発でもっとも重要なRing Handlerについて理解する](https://tech.toyokumo.co.jp/entry/2019/07/03/122656)
- [データベースへ接続する](https://ayato-p.github.io/clojure-beginner/intro_web_development/part5_connect_to_database.html)
- [clojure.java.jdbc](http://clojure.github.io/java.jdbc/#clojure.java.jdbc/get-connection)

- [ClojureのLaciniaでGraphQL API開発してみた](https://qiita.com/lagenorhynque/items/eebb9a36859789520dbf)
- [CLOJURE PROGRAMMING WORLD: 6 ESSENTIAL LIBRARIES AND OTHER TOOLS](https://freshcodeit.com/freshcode-post/clojure-programming-world-frameworks-and-other-tools)

- [Ring | GraphQLize](https://www.graphqlize.org/docs/getting_started/clojure/ring)
- [clojureのroutingライブラリでbidiがわからなかったのでreititを使ったら楽だった。](https://amagasa30.hatenablog.com/entry/2020/12/11/003035)
